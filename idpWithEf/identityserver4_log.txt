2018-09-19 08:55:21.218 +01:00 [INF] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2018-09-19 08:55:21.260 +01:00 [DBG] Using idsrv as default scheme for authentication
2018-09-19 08:55:21.263 +01:00 [DBG] Using idsrv as default scheme for sign-in
2018-09-19 08:55:21.263 +01:00 [DBG] Using idsrv as default scheme for sign-out
2018-09-19 08:55:21.264 +01:00 [DBG] Using idsrv as default scheme for challenge
2018-09-19 08:55:21.265 +01:00 [DBG] Using idsrv as default scheme for forbid
2018-09-19 08:55:30.878 +01:00 [FTL] Application startup exception
System.InvalidOperationException: Unable to resolve service for type 'IdentityServer4.Saml.EntityFramework.Interfaces.ISamlConfigurationDbContext' while attempting to activate 'IdentityServer4.Saml.EntityFramework.Stores.ServiceProviderStore'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(Type serviceType, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(Type serviceType, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, Type serviceType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(Type serviceType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateCallSite(Type serviceType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngine.CreateServiceAccessor(Type serviceType)
   at System.Collections.Concurrent.ConcurrentDictionary`2.GetOrAdd(TKey key, Func`2 valueFactory)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngine.GetService(Type serviceType, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetService[T](IServiceProvider provider)
   at Microsoft.AspNetCore.Builder.IdentityServerSamlApplicationBuilderExtensions.Validate(IApplicationBuilder app)
   at Microsoft.AspNetCore.Builder.IdentityServerSamlApplicationBuilderExtensions.UseIdentityServerSamlPlugin(IApplicationBuilder app)
   at idpWithEf.Startup.Configure(IApplicationBuilder app) in C:\Repos\RSK\samples.identityserver4.saml2pintegration\idpWithEf\Startup.cs:line 80
--- End of stack trace from previous location where exception was thrown ---
   at System.Runtime.ExceptionServices.ExceptionDispatchInfo.Throw()
   at Microsoft.AspNetCore.Hosting.ConventionBasedStartup.Configure(IApplicationBuilder app)
   at Microsoft.AspNetCore.ApplicationInsights.HostingStartup.ApplicationInsightsLoggerStartupFilter.<>c__DisplayClass0_0.<Configure>b__0(IApplicationBuilder builder)
   at Microsoft.ApplicationInsights.AspNetCore.ApplicationInsightsStartupFilter.<>c__DisplayClass0_0.<Configure>b__0(IApplicationBuilder app)
   at Microsoft.AspNetCore.Hosting.Internal.AutoRequestServicesStartupFilter.<>c__DisplayClass0_0.<Configure>b__0(IApplicationBuilder builder)
   at Microsoft.AspNetCore.Hosting.Internal.WebHost.BuildApplication()
2018-09-19 08:56:14.061 +01:00 [INF] You are using the in-memory version of the persisted grant store. This will store consent decisions, authorization codes, refresh and reference tokens in memory only. If you are using any of those features in production, you want to switch to a different store implementation.
2018-09-19 08:56:14.099 +01:00 [DBG] Using idsrv as default scheme for authentication
2018-09-19 08:56:14.102 +01:00 [DBG] Using idsrv as default scheme for sign-in
2018-09-19 08:56:14.103 +01:00 [DBG] Using idsrv as default scheme for sign-out
2018-09-19 08:56:14.103 +01:00 [DBG] Using idsrv as default scheme for challenge
2018-09-19 08:56:14.103 +01:00 [DBG] Using idsrv as default scheme for forbid
2018-09-19 08:56:43.400 +01:00 [DBG] Request path /saml/sso matched to endpoint type "Saml2Sso"
2018-09-19 08:56:43.413 +01:00 [DBG] Mapping found for endpoint: "Saml2Sso", creating handler: IdentityServer4.Saml.Endpoints.Saml2SingleSignOnEndpoint
2018-09-19 08:56:43.416 +01:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Saml.Endpoints.Saml2SingleSignOnEndpoint for /saml/sso
2018-09-19 08:56:43.447 +01:00 [DBG] Start SAML2P SSO request
2018-09-19 08:56:43.467 +01:00 [DBG] No user present in SAML2P SSO request
2018-09-19 08:56:43.473 +01:00 [DBG] Starting SAML 2 SSO request validation
2018-09-19 08:56:43.553 +01:00 [DBG] client configuration validation for client http://localhost:5001/saml succeeded.
2018-09-19 08:56:43.916 +01:00 [INF] Showing login: User is not authenticated
2018-09-19 08:56:44.337 +01:00 [DBG] client configuration validation for client http://localhost:5001/saml succeeded.
2018-09-19 08:56:54.035 +01:00 [DBG] CORS request made for path: /account/login from origin: null but was ignored because path was not for an allowed IdentityServer CORS endpoint
2018-09-19 08:56:54.125 +01:00 [INF] {
  "Name": "User Login Success",
  "Category": "Authentication",
  "EventType": "Success",
  "Id": 1000,
  "Username": "bob",
  "SubjectId": "88421113",
  "DisplayName": "bob",
  "Endpoint": "UI",
  "ActivityId": "0HLGU0LO9NFQV:00000003",
  "TimeStamp": "2018-09-19T07:56:54Z",
  "ProcessId": 11496,
  "LocalIpAddress": "::1:5000",
  "RemoteIpAddress": "::1"
}
2018-09-19 08:56:54.143 +01:00 [DBG] Augmenting SignInContext
2018-09-19 08:56:54.146 +01:00 [DBG] Adding idp claim with value: local
2018-09-19 08:56:54.146 +01:00 [DBG] Adding amr claim with value: pwd
2018-09-19 08:56:54.161 +01:00 [INF] AuthenticationScheme: idsrv signed in.
2018-09-19 08:56:54.165 +01:00 [DBG] client configuration validation for client http://localhost:5001/saml succeeded.
2018-09-19 08:56:54.173 +01:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-09-19 08:56:54.175 +01:00 [INF] AuthenticationScheme: idsrv was successfully authenticated.
2018-09-19 08:56:54.175 +01:00 [DBG] Request path /saml/sso/login matched to endpoint type "Saml2Sso"
2018-09-19 08:56:54.176 +01:00 [DBG] Mapping found for endpoint: "Saml2Sso", creating handler: IdentityServer4.Saml.Endpoints.Saml2SingleSignOnEndpoint
2018-09-19 08:56:54.177 +01:00 [INF] Invoking IdentityServer endpoint: IdentityServer4.Saml.Endpoints.Saml2SingleSignOnEndpoint for /saml/sso/login
2018-09-19 08:56:54.182 +01:00 [DBG] Start SAML2P SSO request (after login)
2018-09-19 08:56:54.184 +01:00 [DBG] User in SAML2P SSO request: 88421113
2018-09-19 08:56:54.184 +01:00 [DBG] Starting SAML 2 SSO request validation
2018-09-19 08:56:54.185 +01:00 [DBG] client configuration validation for client http://localhost:5001/saml succeeded.
2018-09-19 08:56:54.192 +01:00 [DBG] IsActive called from: AuthorizeEndpoint
2018-09-19 08:56:54.211 +01:00 [DBG] Creating SAML 2.0 response.
2018-09-19 08:56:54.224 +01:00 [DBG] Get profile called for subject 88421113 from client RSK SAML2P Test Client with claim types ["sub","name","family_name","given_name","middle_name","nickname","preferred_username","profile","picture","website","gender","birthdate","zoneinfo","locale","updated_at"] via SAML2P
2018-09-19 08:56:54.236 +01:00 [DBG] Issued claims: ["name","given_name","family_name","website"]
2018-09-19 08:56:54.367 +01:00 [INF] SAML2P SSO endpoint response
{
  "SubjectId": "88421113",
  "ClientId": "http://localhost:5001/saml",
  "BindingType": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect",
  "RelayState": "BZMJvpXlRXy0QLfdeVqXhHij"
}
2018-09-19 08:56:54.394 +01:00 [DBG] Augmenting SignInContext
2018-09-19 08:56:54.394 +01:00 [INF] AuthenticationScheme: idsrv signed in.
